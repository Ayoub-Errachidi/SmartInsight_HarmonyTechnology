{% load custom_tags %}
{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataSet - SmartInsight</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="{% static 'css/machine_learning/styles_prediction.css' %}">
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <a href="#" class="logo">
            <i class='bx bx-stats'></i>
            <div class="logo-name"><span>Smart</span>Insight</div>
        </a>
        <ul class="side-menu">
            <li><a href="{% url 'dashboard' %}"><i class='bx bxs-dashboard'></i>Import a file</a></li>
            <li><a href="{% url 'informations_dataset' %}"><i class='bx bxs-color'></i>Dashboard</a></li>
            <li class="active"><a href="{% url 'dataset' %}"><i class='bx bx-data'></i>DataSet</a></li>
            <li><a href="{% url 'statistiques' %}"><i class='bx  bx-bar-chart'></i>Statistics</a></li>
            <li><a href="{% url 'visualisations' %}"><i class='bx bx-scatter-chart' ></i>Visualization</a></li>
            <li><a href="{% url 'pretraitement_complet' %}"><i class='bx bx-message-square-dots'></i>Full cleaning</a></li>
            <li><a href="{% url 'choix_cible' %}"><i class='bx bx-crosshair'></i>Target selection</a></li>
            <li><a href="{% url 'transformation_colonnes' %}"><i class='bx bx-analyse'></i>Data Preprocessing </a></li>
            <li><a href="{% url 'resultats_entrainement' %}"><i class="bx bx-bot"></i>Model Training</a></li>
            <li><a href="{% url 'prediction' %}"><i class='bx bx-check-shield'></i>Prediction</a></li>
            <li><a href="{% url 'rapport_pdf' %}"><i class='bx bx-cloud-upload' ></i>Download PDF</a></li>
        </ul>
    </div>
    <!-- End of Sidebar -->

    <!-- Main Content -->
    <div class="content">
        <!-- Navbar -->
        <nav>
            <i class='bx bx-menu'></i>
            <form action="#">
                <div class="form-input">
                    <input type="search" placeholder="Search...">
                    <button class="search-btn" type="submit"><i class='bx bx-search'></i></button>
                </div>
            </form>
            <input type="checkbox" id="theme-toggle" hidden>
            <label for="theme-toggle" class="theme-toggle"></label>
            <a href="#" class="notif">
                <i class='bx bx-bell'></i>
                <span class="count">12</span>
            </a>
            <a href="#" class="profile">
                <img src="{% static 'images/111.png' %}">
            </a>
        </nav>
        <!-- End of Navbar -->

        <main>
            <div class="page-header">
                Faire une Prédiction
            </div>

            <div class="card">
                <div class="card-body">
                    {% if error %}
                        <div class="alert alert-danger">{{ error }}</div>
                    {% endif %}

                    <form method="post" action="{% url 'prediction' %}">
                        {% csrf_token %}
                        <div class="row">
                            {% for feature in colonnes_features %}
                                <div class="col-md-6 mb-3" style="padding: 10px;">
                                    <label class="form-label">{{ feature }}</label>
                                    <div style="display:flex; gap:6px;">
                                        <select name="{{ feature }}_select" class="form-select" style="flex:1; padding:6px; border-radius:6px;">
                                            <option value="">-- Choisir une valeur --</option>
                                            {% for val in unique_values|get_item:feature %}
                                                <option value="{{ val }}">{{ val }}</option>
                                            {% endfor %}
                                        </select>
                                        <input type="text" name="{{ feature }}_input" class="form-control" placeholder="Ou entrer une valeur" style="flex:1; padding:6px; border-radius:6px;">
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        <div class="mb-3" style="margin-top:12px;">
                            <label class="form-label">Choisir le modèle</label>
                            <select name="modele_nom" class="form-select" style="width:100%; padding:6px; border-radius:6px;">
                                {% for m in available_models %}
                                    <option value="{{ m }}" {% if selected_model == m %}selected{% endif %}>{{ m }}</option>
                                {% endfor %}
                            </select>
                            <div style="font-size:0.85rem; color:var(--dark-grey); margin-top:4px;">Si mode clustering : KMeans est utilisé par défaut.</div>
                        </div>

                        <div class="d-grid" style="text-align:center; margin-top:16px;">
                            <button type="submit" class="btn-primary" style="padding:10px 20px; border-radius:8px;">Prédire</button>
                        </div>
                    </form>
                </div>
            </div>

            {% if predictions %}
            <div class="card" style="margin-top:20px;">
                <div class="card-body">
                    <h4>Résultat</h4>
                    <p><strong>Modèle :</strong> {{ selected_model }}</p>
                    <p><strong>Prédiction :</strong>
                        {% for p in predictions %}
                            <span class="highlight">{{ p }}</span>
                        {% endfor %}
                    </p>

                    {% if probabilities %}
                        <h5 style="margin-top:12px;">Probabilités (si disponibles)</h5>
                        <pre>{{ probabilities }}</pre>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </main>

        

    </div>

    <script src="{% static 'js/dashboard.js' %}"></script>
    
</body>
</html>